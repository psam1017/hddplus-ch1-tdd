### 1주차 멘토링 사전 노트의 작성 내용을 백업한 파일입니다.

- 과제 해결을 위해 사용한 도구 및 고민
    - 평소에 단위테스트를 잘 안 하던 게 버릇이 돼서, 단위테스트를 할지 말지 좀 고민했습니다.
    - 직접 만든 mock 객체도 있고, Controller Test 를 위해 BDDMockito 를 사용하기도 했습니다. 테스트 케이스끼리 서로 영향을 주지 않도록 unique 한 데이터를 가지고 있는 UniqueUserIdHolder 를 만들어 롤백 없이 테스트들을 통과시켰습니다.
- 확실히 이해하고 있는 부분 (예: 특정 개념, 기술, 도구의 사용법)
    - @SpringBootTest 사용해서 통합 테스트하기, 필요할 때 Mocking 하기
    - @SpringBootTest 를 사용하지 않고 단위 테스트하기
- 더 알아야 할 부분 (예: 특정 부분의 논리, 절차, 원리 등)
    - 한 스레드 안에서 여러 스레드들을 sleep 하지 않고 순서 제어하기



- 문제 상황
    - 테스트 중에 외부 라이브러리 도입 없이 스레드 순서를 제어하기
- 시도하거나 고민한 방법의 결과
    - 넉넉하게 sleep 시켜서 강제로 순서를 제어했고, 테스트는 통과함. 하지만 불필요한 지연과 JVM 의 동작에 따라 언제든지 테스트 결과가 달라질 수 있음
- 추가로 떠오르는 대안
    - 코드 수준의 통합 테스트를 포기하고, K6 를 사용하여 간단하게 테스트하고 이를 문서로 정리
- 여전히 해결되지 않은 궁금증
    - 테스트 코드에서 과제 상황과 같이 동시다발적인 요청 상황을 의도적으로 재현하고, sleep 없이 테스트를 통과시킬 수 있는가?



- Thread.sleep 없이 여러 스레드 실행시켜서 실행 순서 제어하기가 가능할까요?
- PessimisticLockException 없이 Parallel Test 통과시키기
    - 병렬 테스트를 위해 아래 블로그와 유사하게 테스트를 실행시켰을 때 테스트 수가 많아지면 PessimisticLockException 이 발생해서 확률적으로 테스트가 gradlew test 가 실패하게 됩니다.
        - 병렬 테스트에서 Lock 관련된 문제를 회피하고 테스트를 성공시킬 방안이 있을까요?
        - 대형기업에서 병렬 테스트를 애용하나요? 제 주변에서는 병렬 테스트를 하는 사람을 못 봐서 궁금합니다.
        - https://yeon-kr.tistory.com/212
- 유효성 검사 로직을 모두 Service 에서 옮기고 Service 만 테스트했을 때의 side effect
    - 테스트는 그 대상이 되는 객체의 구현 동작만을 테스트해야 합니다. Spring Boot 환경에서 validation library 를 사용했을 때 보통 Controller 에서 @Valid, @Validated 를 사용해서 값에 대한 유효성 검사를 수행하고 BindException 이나 ConstraintViolationException 을 던집니다.
    - 하지만 위 방식으로는 동적인 유효성 검사나 도메인 엔티티의 값을 비교하고 던져야 할 유효성 검사까지는 제어하지 못 합니다.
    - Controller 는 유효성 검사를 제외하면 대부분 얇은 계층이기 때문에 성공 테스트 이외에는 테스트할 부분이 없습니다. 그 결과 Controller 테스트는 1번의 성공 테스트와 n 번의 유효성 검사 테스트로 이루어집니다.
    - Controller 에서도 유효성 검사를 수행하고, Service 에서도 나머지 유효성 검사를 수행하는 것은 책임이 양분되어 유지보수에 좋지 않다고 생각합니다. 따라서 앞으로는 Service 계층에서 @Valid 와 AOP 를 사용해서 Service 계층에서 모든 유효성 검사까지 수행하고, 유효성 검사 테스트까지 ServiceTest 에서 수행하려고 합니다. 현장에서는 spring rest docs 를 사용하고 있기에 Controller 는 문서를 생성하면서 딱 한 번 성공 테스트만을 검증할 계획입니다.
    - 여기서 찝찝한 점은, Spring 이 괜히 Controller 에서 유효성 검사를 지원하는 게 아닐 것 같은데 내 마음대로 커스텀해도 되는지 입니다. Service 에서 유효성 검사를 하는 것이 제가 미처 발견하지 못한 side effect 가 있어서 Controller 에서 유효성 검사를 하게 만든 것일 수도 있습니다.
    - 이러한 아키텍처에 대해 어떻게 평가하시나요? 그리고 side effect 가 발생할 수 있을까요?